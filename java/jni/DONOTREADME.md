# An extended CMakeLists.txt

### CMake specifics
```
cmake_minimum_required(VERSION 3.7)
project (HelloJNI)
```

### Cmake will deal with java
```
find_package(Java REQUIRED)
include(UseJava)
set(CMAKE_JAVA_COMPILE_FLAGS "-source" "1.8" "-target" "1.8")
```

### Generate JAR and CLASS files `build/CMakeFiles/HelloJNI.dir/HelloJNI.class` & `build/HelloJNI.jar`
```
add_jar(helloClass HelloJNI.java)
get_target_property(_jarFile  helloClass JAR_FILE)
get_target_property(_classDir helloClass CLASSDIR)
add_custom_command(TARGET helloClass POST_BUILD COMMENT "-----> CLASSDIR: ${_classDir}")
add_custom_command(TARGET helloClass POST_BUILD COMMENT "-----> JAR_FILE: ${_jarFile}" )
```

### Generate HEADER for CLASS file `build/HelloJNI.h`
```
create_javah(TARGET javaHeader
	CLASSES HelloJNI
	CLASSPATH ${_classDir}
	DEPENDS helloClass
)
```

### Generate LIBRARY file `build/libhello.so`
(equivalent to `-I/usr/lib/jvm/java-8-openjdk-amd64/include	-I/usr/lib/jvm/java-8-openjdk-amd64/include/linux`)
```
include_directories(
	/usr/lib/jvm/java-8-openjdk-amd64/include
	/usr/lib/jvm/java-8-openjdk-amd64/include/linux
	${CMAKE_BINARY_DIR}
)
add_library(hello SHARED HelloJNIImpl.cpp) # `-shared`
set_target_properties(hello PROPERTIES POSITION_INDEPENDENT_CODE TRUE) # `-fPIC`
add_dependencies(hello javaHeader) # `HelloJNI.h` must exist first
```

### With BASH...
```
export JAVA_INC=/usr/lib/jvm/java-8-openjdk-amd64/include
javac HelloJNI.java
javah HelloJNI
g++ -std=c++11 -shared -fPIC -I$JAVA_INC -I$JAVA_INC/linux HelloJNIImpl.cpp -o libhello.so
java -Djava.library.path=. HelloJNI
```

### === HelloJNI.java ===
```
	public class HelloJNI {
		static {
			System.loadLibrary("hello");	// loads libhello.so
		}

		private native void sayHello(String name);

		public static void main(String[] args) {
			new HelloJNI().sayHello("World");
		}
	}
```

### === HelloJNI.h ===
```
	/* DO NOT EDIT THIS FILE - it is machine generated */
	#include <jni.h>
	/* Header for class HelloJNI */

	#ifndef _Included_HelloJNI
	#define _Included_HelloJNI
	#ifdef __cplusplus
	extern "C" {
	#endif
	/*
	 * Class:     HelloJNI
	 * Method:    sayHello
	 * Signature: (Ljava/lang/String;)V
	 */
	JNIEXPORT void JNICALL Java_HelloJNI_sayHello
	  (JNIEnv *, jobject, jstring);

	#ifdef __cplusplus
	}
	#endif
	#endif
```

### === HelloJNIImpl.cpp ===
```
	#include <iostream>
	#include <jni.h>
	#include "HelloJNI.h"   // auto-generated by `javah HelloJNI`

	/*
	 * Class:	HelloJNI
	 * Method:	sayHello
	 * Signature: 	(Ljava/lang/String;)V
	 */
	JNIEXPORT void JNICALL Java_HelloJNI_sayHello (JNIEnv *env, jobject thisObj, jstring arg) {
		const char *sarg = env->GetStringUTFChars(arg, 0);
		std::cerr << "Hello, " << sarg << "!" << std::endl;
		env->ReleaseStringUTFChars(arg, sarg);
	}
```
