# JAVA/C++ bindings example using JNI

_Based on https://gist.github.com/santa4nt/4a8fd626335e36c94356_

This is quite simple. First, we have the Java file, that defines the library to use and the functions to access in C++:

### === HelloJNI.java ===
```
	public class HelloJNI {
		static {
			System.loadLibrary("hello");	// loads libhello.so
		}

		private native void sayHello(String name);

		public static void main(String[] args) {
			new HelloJNI().sayHello("World");
		}
	}
```
Compiling such file to a .class file (or .jar), and using `javah`, we generate the interface as a header file:

### === HelloJNI.h ===
```
	/* DO NOT EDIT THIS FILE - it is machine generated */
	#include <jni.h>
	/* Header for class HelloJNI */

	#ifndef _Included_HelloJNI
	#define _Included_HelloJNI
	#ifdef __cplusplus
	extern "C" {
	#endif
	/*
	 * Class:     HelloJNI
	 * Method:    sayHello
	 * Signature: (Ljava/lang/String;)V
	 */
	JNIEXPORT void JNICALL Java_HelloJNI_sayHello
	  (JNIEnv *, jobject, jstring);

	#ifdef __cplusplus
	}
	#endif
	#endif
```

And that's what must be implemented:

### === HelloJNIImpl.cpp ===
```
	#include <iostream>
	#include <jni.h>
	#include "HelloJNI.h"   // auto-generated by `javah HelloJNI`

	/*
	 * Class:	HelloJNI
	 * Method:	sayHello
	 * Signature: 	(Ljava/lang/String;)V
	 */
	JNIEXPORT void JNICALL Java_HelloJNI_sayHello (JNIEnv *env, jobject thisObj, jstring arg) {
		const char *sarg = env->GetStringUTFChars(arg, 0);
		std::cerr << "Hello, " << sarg << "!" << std::endl;
		env->ReleaseStringUTFChars(arg, sarg);
	}
```

Using CMake to build, we have:

### === CMakeLists.txt ===

```
cmake_minimum_required(VERSION 3.7)
project (HelloJNI)

# Cmake will deal with java
find_package(Java REQUIRED)
include(UseJava)
set(CMAKE_JAVA_COMPILE_FLAGS "-source" "1.8" "-target" "1.8")

# Generate JAR file build/HelloJNI.jar
add_jar(helloJar HelloJNI.java)

# Generate HEADER for CLASS file build/HelloJNI.h
create_javah(TARGET javaHeader
	CLASSES HelloJNI
	CLASSPATH helloJar # Target name is enough
	DEPENDS helloJar
)

# Generate LIBRARY file build/libhello.so
include_directories(# -I/usr/lib/jvm/java-8-openjdk-amd64/include -I/usr/lib/jvm/java-8-openjdk-amd64/include/linux
	/usr/lib/jvm/java-8-openjdk-amd64/include
	/usr/lib/jvm/java-8-openjdk-amd64/include/linux
	${CMAKE_BINARY_DIR}
)
add_library(hello SHARED HelloJNIImpl.cpp)
set_target_properties(hello PROPERTIES POSITION_INDEPENDENT_CODE TRUE) # -fPIC
add_dependencies(hello javaHeader) # the HelloJNI.h must exist first
```
